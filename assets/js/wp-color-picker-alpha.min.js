/*!
 * wp-color-picker-alpha
 *
 * Overwrite Automattic Iris for enabled Alpha Channel in wpColorPicker
 * Only run in input and is defined data alpha in true
 *
 * Version: 3.0.0
 * https://github.com/kallookoo/wp-color-picker-alpha
 * Licensed under the GPLv2 license or later.
 */
!function(t){if(!t.wp)return;if(!t.wp.wpColorPicker)return;var o=t.fn.wpColorPicker.Constructor;t.fn.wpColorPicker.Constructor=function(e,a){var r,n=this;if(a=a||{},void 0!==a.alpha&&a.alpha){if(r=a.alpha,a.alpha=parseFloat(a.alpha)||0,a.alpha<0?a.alpha=0:a.alpha>1&&(a.alpha=1),t.support.rgba)a.type="iris";else{if(!t.support.opacity)return n;a.type="iris"}return a.mode="hsla"}o.call(n,e,a),a.alpha&&t.support.rgba&&n._addAlpha(r)};var e=t.fn.wpColorPicker.Constructor.prototype,a=e.close;e.close=function(){this.element.hasClass("wp-color-picker-alpha")&&this.element.parents(".wp-picker-container").find(".wp-color-result-alpha").remove(),a.call(this)};var r=e._addListeners;e._addListeners=function(){if(!this.options.alpha)return r.call(this);var o=this,e=o.element,a=e.parents(".wp-picker-container:first");r.call(o),e.on("change.wpcolorpickeralpha",function(){o._updateAlpha();var t=e.val().replace(/\s+/g,"");if(""===o.element.val().replace(/\s+/g,"")||o.element.hasClass("iris-error"))a.find(".wp-color-result-alpha").css("background-color","");else{if(t.match(/^#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/))return a.find(".wp-color-result-alpha").css("background-color",o._to_rgba(t,o.options.alpha)),void o.element.removeClass("iris-error");if(t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([0-1](?:\.[0-9]{1,2})?)\)$/)){var r=t.replace(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([0-1](?:\.[0-9]{1,2})?)\)$/,"$1,$2,$3,$4").split(",");if(4!==r.length)return;if(255<r[0]||255<r[1]||255<r[2]||1<r[3])return;return a.find(".wp-color-result-alpha").css("background-color",t),o.options.alpha=parseFloat(r[3]),void o.element.removeClass("iris-error")}o.element.addClass("iris-error")}})};var n=e._updatePickerContainer;e._updatePickerContainer=function(){if(!this.options.alpha)return n.call(this);var t=this.element.parents(".wp-picker-container:first");t.find(".wp-color-result-alpha").css("background-color",this.element.val())};var i=e._change;e._change=function(){if(!this.options.alpha)return i.call(this);var t=this,o=t.element;if(o.hasClass("iris-error")||""===o.val().replace(/\s+/g,""))return void t.options.change.call(t,{target:o.get(0)},t._getColor());var e=t._getColor();t.options.change.call(t,{target:o.get(0)},e)};var l=e._addInputListeners;e._addInputListeners=function(t){if(!this.options.alpha)return l.call(this,t);var a=this,r=function(e){var r=new Color(e.target.value),n=e.target.value.replace(/\s+/g,""),i=a.options.alpha,l=a.element.parents(".wp-picker-container:first");if(""===e.target.value.replace(/\s+/g,""))return a.element.removeClass("iris-error"),void l.find(".wp-color-result-alpha").css("background-color","");if(n.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([0-1](?:\.[0-9]{1,2})?)\)$/)){var c=n.replace(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([0-1](?:\.[0-9]{1,2})?)\)$/,"$1,$2,$3,$4").split(",");if(4!==c.length)return;if(255<c[0]||255<c[1]||255<c[2]||1<c[3])return;a.options.alpha=parseFloat(c[3]),a._updateAlpha(),a.element.removeClass("iris-error"),l.find(".wp-color-result-alpha").css("background-color",n)}else{if(!r.error)return a.options.alpha=i,a._updateAlpha(),a.element.removeClass("iris-error"),void l.find(".wp-color-result-alpha").css("background-color",a._to_rgba(r.toString(),a.options.alpha));a.element.addClass("iris-error")}};t.on("change.wpcolorpicker",r).on("keyup.wpcolorpicker",r)};var c=e._initControls;e._initControls=function(){if(!this.options.alpha)return c.call(this);var r=this,n=r.element.parents(".wp-picker-container:first"),i=r.element.val().replace(/\s+/g,"");n.find(".wp-color-result").removeClass("wp-picker-open").addClass("wp-color-result-alpha"),n.find(".wp-color-result-alpha").css("background-color",""!==i?r._to_rgba(i,r.options.alpha):""),c.call(r),n.find(".iris-square-slider .ui-slider-handle").on("focus",function(){r.element.trigger("focus")}),n.find(".iris-alpha-slider").on("slide",function(t,o){var e=r._getColor();r.options.alpha=parseFloat(o.value/100),r.element.trigger("change"),r.options.change.call(r,{target:r.element.get(0)},e)})};var s=e._dimensions;e._dimensions=function(t){if(!this.options.alpha)return s.call(this,t);var o=this,e=o.element.parents(".wp-picker-container:first"),a={controlWidth:e.find(".iris-controls").width(),pickerWidth:e.find(".iris-picker").width(),marginLeft:e.find(".iris-picker").css("margin-left"),controlHeight:e.find(".iris-controls").height(),totalHeight:e.find(".iris-picker").outerHeight()},r=o.element.val().replace(/\s+/g,"");""===r&&o.element.hasClass("iris-error")||e.find(".wp-color-result-alpha").css("background-color",""!==r?o._to_rgba(r,o.options.alpha):""),s.call(o,t),e.find(".iris-alpha-slider").css({width:a.controlWidth-21,height:24,position:"absolute",top:a.controlHeight,left:a.marginLeft,border:"1px solid #ddd","border-top":"none","background-color":"#fff"}),e.find(".iris-strip .ui-slider-handle").css({width:18,height:18,border:"3px solid #fff","border-radius":"50%","-webkit-box-shadow":"0 1px 2px rgba(0,0,0,.4)","-moz-box-shadow":"0 1px 2px rgba(0,0,0,.4)","box-shadow":"0 1px 2px rgba(0,0,0,.4)",position:"absolute",top:"50%",marginTop:"-9px",left:"-9px","background-color":"transparent"}),e.find(".iris-alpha-slider .ui-slider-handle").css("left","-9px"),e.find(".iris-picker").css("height",a.totalHeight+30)};e._addAlpha=function(e){var a=this,r=a.element,n=r.parents(".wp-picker-container:first"),i=t('<div class="iris-alpha-slider"><div class="iris-alpha-text"></div></div>').appendTo(n.find(".iris-picker")),l=i.find(".iris-alpha-text"),c=parseFloat(e)||0,s=r.val().replace(/\s+/g,"");a.options.alpha=c,r.addClass("wp-color-picker-alpha"),i.slider({orientation:"horizontal",min:0,max:100,step:1,value:100*c,slide:function(t,o){a.options.alpha=parseFloat(o.value/100),a._updateAlpha(),a._change.call(a)}}),a._updateAlpha(),""!==s?n.find(".wp-color-result-alpha").css("background-color",a._to_rgba(s,a.options.alpha)):n.find(".wp-color-result-alpha").css("background-color","")},e._updateAlpha=function(){var t=this,o=t.element.parents(".wp-picker-container:first");o.find(".iris-alpha-text").text("Alpha: "+parseInt(100*t.options.alpha)+"%"),o.find(".iris-alpha-slider").slider("value",100*t.options.alpha),o.find(".iris-alpha-slider").find(".ui-slider-handle").css("left",100*t.options.alpha+"%")},e._getColor=function(){var t=this.element.val().replace(/\s+/g,""),o=new Color(t).toString();return""!==t?this._to_rgba(o,this.options.alpha):""},e._to_rgba=function(t,o){t=t.replace(/\s+/g,"");var e=void 0!==o?o:1;if(t.match(/^#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/)){var a=new Color(t).toRgb();return"rgba("+a.r+","+a.g+","+a.b+","+e+")"}if(t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([0-1](?:\.[0-9]{1,2})?)\)$/))return t;var r=new Color(t).toRgb();return"rgba("+r.r+","+r.g+","+r.b+","+e+")"}}(jQuery);
